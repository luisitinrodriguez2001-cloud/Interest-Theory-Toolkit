<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>FM-Story</title>
  <link rel="stylesheet" href="./style.css">

</head>
<body>
<!-- partial:index.partial.html -->
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Financial Math Storybook — Exam FM (Noir Edition)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Cinematic, interactive walkthrough of Exam FM formulas—with story-driven scenes, calculators, and sources." />
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="stylesheet" href="styles.css" />
  <!-- MathJax for LaTeX rendering -->
  <script>
    window.MathJax = { tex: { inlineMath: [['\\(','\\)'], ['$', '$']] }, svg: { fontCache: 'global' } };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>

  <!-- CINEMA OVERLAYS -->
  <div id="letterbox" aria-hidden="true">
    <div class="bar top"></div>
    <div class="bar bottom"></div>
  </div>
  <div id="cut" aria-hidden="true"></div>
  <div id="film-grain" aria-hidden="true"></div>

  <div id="app">
    <aside class="sidebar" aria-label="Navigation">
      <div class="brand">
        <div class="logo">FM</div>
        <div class="brand-text">
          <strong>Financial Math</strong><br/>
          <span>Noir Storybook</span>
        </div>
      </div>

      <div class="author">
        <div class="byline">Built by <strong>Luis Rodriguez</strong></div>
        <div class="socials">
          <a class="chip ig magnet" target="_blank" rel="noopener" href="https://instagram.com/luisitin2001">Instagram @luisitin2001</a>
          <a class="chip tt magnet" target="_blank" rel="noopener" href="https://www.tiktok.com/@luisitin2001">TikTok @luisitin2001</a>
        </div>
      </div>

      <nav>
        <button class="nav-link active magnet" data-target="scene-intro">Prologue</button>
        <button class="nav-link magnet" data-target="scene-1">1. Interest & Rates</button>
        <button class="nav-link magnet" data-target="scene-2">2. Level Annuities</button>
        <button class="nav-link magnet" data-target="scene-3">3. Varying Annuities</button>
        <button class="nav-link magnet" data-target="scene-4">4. Loans & Amort.</button>
        <button class="nav-link magnet" data-target="scene-5">5. Bonds</button>
        <button class="nav-link magnet" data-target="scene-6">6. Duration & Convexity</button>
        <button class="nav-link magnet" data-target="scene-7">7. Term Structure</button>
        <button class="nav-link magnet" data-target="scene-8">8. Immunization</button>
        <button class="nav-link magnet" data-target="scene-9">9. Swaps</button>
        <button class="nav-link magnet" data-target="scene-10">10. Odds & Ends</button>
      </nav>

      <div class="sources">
        <button id="toggle-sources" class="ghost magnet link-animated">Sources & Citations</button>
        <div class="speed">
          <label>Story speed:
            <input id="type-speed" type="range" min="0.6" max="2.0" value="1.0" step="0.1">
            <span id="speed-readout">1.0×</span>
          </label>
        </div>
      </div>
    </aside>

    <main class="content">
      <!-- PROLOGUE -->
      <section id="scene-intro" class="scene active" aria-live="polite">
        <header class="scene-header">
          <h1 class="gradient-text">Prologue — Steam, Streetlights, and a Balance Sheet</h1>
          <p class="lede">
            Night rain on the pavement. Alex pushes a coffee cart under a flickering marquee. The dream? A permanent café. The puzzle? Money across time.
          </p>
          <div class="controls">
            <button class="primary magnet play" data-play="scene-intro">▶ Play Scene</button>
          </div>
        </header>

        <div class="story">
          <div class="narration" id="nar-scene-intro"></div>
        </div>
      </section>

      <!-- 1. INTEREST & RATE CONVERSIONS -->
      <section id="scene-1" class="scene">
        <header class="scene-header">
          <h2 class="gradient-text">1) Time Value & Rate Conversions</h2>
          <p>Effective vs nominal vs force; equation of value.</p>
          <div class="controls">
            <button class="primary magnet play" data-play="scene-1">▶ Play Scene</button>
          </div>
        </header>

        <div class="story">
          <div class="narration" id="nar-scene-1"></div>
        </div>

        <div class="grid two">
          <article class="card" data-reveal>
            <h3>Core identities</h3>
            <p class="math">
              \(A(t)=A(0)(1+i)^t,\ v=(1+i)^{-1},\ d=\frac{i}{1+i},\ 1+i=e^{\delta}\Rightarrow \delta=\ln(1+i)\).
            </p>
            <p class="cite">
              <a class="link-animated" href="#sources" data-source="soa-syllabus">[SOA Syllabus]</a>
              <a class="link-animated" href="#sources" data-source="actex-fm">[ACTEX Sheet]</a>
              <a class="link-animated" href="#sources" data-source="kent-formulas">[Kent Formulas]</a>
            </p>
          </article>

          <article class="card" data-reveal>
            <h3>Nominal ↔ Effective ↔ Continuous</h3>
            <p class="math">
              \(i=(1+\tfrac{j^{(m)}}{m})^{m}-1,\quad \delta=m\ln(1+\tfrac{j^{(m)}}{m}),\quad i=(1-\tfrac{d^{(m)}}{m})^{-m}-1\).
            </p>
            <div class="inputs">
              <label>Nominal j<sup>(m)</sup> (%): <input type="number" id="j-nom" value="12" step="0.01"></label>
              <label>m (comp/yr): <input type="number" id="m-comp" value="12" min="1" step="1"></label>
              <div class="result"><span>Effective i:</span> <code id="eff-i">—</code></div>
              <div class="result"><span>Force δ:</span> <code id="eff-delta">—</code></div>
            </div>
            <p class="cite">
              <a class="link-animated" href="#sources" data-source="actex-fm">[ACTEX Sheet]</a>
              <a class="link-animated" href="#sources" data-source="kent-formulas">[Kent Formulas]</a>
            </p>
          </article>

          <article class="card full" data-reveal>
            <h3>Equation of Value</h3>
            <p class="math">
              \(PV=\sum_t CF_t\,v^t\), or continuous \(PV=\int_0^T c(t)e^{-\int_0^t \delta(s)\,ds}\,dt\).
            </p>
            <div class="inputs">
              <label>Cashflows (t=1..n):
                <input type="text" id="cf-seq" value="100, 120, 150, 150, 200">
              </label>
              <label>i (%):
                <input type="number" id="cf-i" value="6" step="0.01">
              </label>
              <button class="ghost magnet" id="btn-cf-pv">Compute PV</button>
              <div class="result"><span>PV:</span> <code id="cf-pv">—</code></div>
            </div>
            <p class="cite">
              <a class="link-animated" href="#sources" data-source="soa-syllabus">[SOA Syllabus]</a>
              <a class="link-animated" href="#sources" data-source="actex-fm">[ACTEX Sheet]</a>
            </p>
          </article>
        </div>

        <footer class="scene-footer">
          <button class="next magnet" data-next="scene-2">CUT → Level Annuities</button>
        </footer>
      </section>

      <!-- 2. LEVEL ANNUITIES -->
      <section id="scene-2" class="scene">
        <header class="scene-header">
          <h2 class="gradient-text">2) Level Annuities (Discrete & Continuous)</h2>
          <p>Immediate vs due, PV/AV, perpetuities, and m-thly payments.</p>
          <div class="controls">
            <button class="primary magnet play" data-play="scene-2">▶ Play Scene</button>
          </div>
        </header>

        <div class="story">
          <div class="narration" id="nar-scene-2"></div>
        </div>

        <div class="grid two">
          <article class="card" data-reveal>
            <h3>Immediate & Due</h3>
            <p class="math">
              \(a_{\overline{n}|i}=\frac{1-v^{n}}{i},\quad
              s_{\overline{n}|i}=\frac{(1+i)^n-1}{i}\).<br/>
              \(\ddot a_{\overline{n}|i}=(1+i)\,a_{\overline{n}|i}=\frac{1-v^{n}}{d}\).
            </p>
            <div class="inputs">
              <label>n: <input type="number" id="ann-n" value="10" min="1"></label>
              <label>i (%): <input type="number" id="ann-i" value="6" step="0.01"></label>
              <button class="ghost magnet" id="btn-ann">Compute</button>
              <div class="result"><span>aₙ|i:</span> <code id="res-a-ni">—</code></div>
              <div class="result"><span>äₙ|i:</span> <code id="res-ada-ni">—</code></div>
              <div class="result"><span>sₙ|i:</span> <code id="res-s-ni">—</code></div>
            </div>
            <p class="cite"><a class="link-animated" href="#sources" data-source="actex-fm">[ACTEX Sheet]</a> <a class="link-animated" href="#sources" data-source="kent-formulas">[Kent Formulas]</a></p>
          </article>

          <article class="card" data-reveal>
            <h3>Perpetuities & Continuous</h3>
            <p class="math">
              Perpetuity immediate: \(a_{\overline{\infty}|i}=\frac{1}{i}\).<br/>
              Continuous PV: \(\bar a_{\overline{n}|\delta}=\frac{1-e^{-\delta n}}{\delta}\).
            </p>
            <div class="inputs">
              <label>δ (%): <input type="number" id="cont-delta" value="5" step="0.01"></label>
              <label>n: <input type="number" id="cont-n" value="10" min="1"></label>
              <button class="ghost magnet" id="btn-cont-ann">Compute</button>
              <div class="result"><span>āₙ|δ:</span> <code id="res-a-bar">—</code></div>
            </div>
            <p class="cite"><a class="link-animated" href="#sources" data-source="actex-fm">[ACTEX Sheet]</a></p>
          </article>

          <article class="card full" data-reveal>
            <h3>m-thly Level Payments</h3>
            <p class="math">
              \(i_m=(1+i)^{1/m}-1,\ N=mn,\ a_{\overline{N}|i_m}=\frac{1-(1+i_m)^{-N}}{i_m}\).
            </p>
            <div class="inputs">
              <label>i (% eff/yr): <input type="number" id="m-i" value="6" step="0.01"></label>
              <label>m: <input type="number" id="m-m" value="12" min="1"></label>
              <label>n (yrs): <input type="number" id="m-n" value="5" min="1"></label>
              <button class="ghost magnet" id="btn-m-ann">Compute</button>
              <div class="result"><span>a<sub>N</sub>|i<sub>m</sub>:</span> <code id="res-m-a">—</code></div>
            </div>
            <p class="cite"><a class="link-animated" href="#sources" data-source="actex-fm">[ACTEX Sheet]</a></p>
          </article>
        </div>

        <footer class="scene-footer">
          <button class="next magnet" data-next="scene-3">CUT → Varying Annuities</button>
        </footer>
      </section>

      <!-- 3. VARYING ANNUITIES -->
      <section id="scene-3" class="scene">
        <header class="scene-header">
          <h2 class="gradient-text">3) Varying Annuities (Arithmetic & Geometric)</h2>
          <p>When payments step up or grow at g.</p>
          <div class="controls">
            <button class="primary magnet play" data-play="scene-3">▶ Play Scene</button>
          </div>
        </header>

        <div class="story">
          <div class="narration" id="nar-scene-3"></div>
        </div>

        <div class="grid two">
          <article class="card" data-reveal>
            <h3>Arithmetic Gradients</h3>
            <p class="math">
              Increasing: \({}^{I}a_{\overline{n}|i}=\dfrac{a_{\overline{n}|i}-n v^{n}}{i}\).<br/>
              Decreasing: \({}^{D}a_{\overline{n}|i}=\dfrac{n - a_{\overline{n}|i}}{i}\).
            </p>
            <div class="inputs">
              <label>n: <input type="number" id="ari-n" value="8"></label>
              <label>i (%): <input type="number" id="ari-i" value="5" step="0.01"></label>
              <label>Step size (currency): <input type="number" id="ari-step" value="100"></label>
              <button class="ghost magnet" id="btn-ari">Compute</button>
              <div class="result"><span>PV Increasing:</span> <code id="res-ari-inc">—</code></div>
              <div class="result"><span>PV Decreasing:</span> <code id="res-ari-dec">—</code></div>
            </div>
            <p class="cite"><a class="link-animated" href="#sources" data-source="actex-fm">[ACTEX Sheet]</a></p>
          </article>

          <article class="card" data-reveal>
            <h3>Geometric Growth (\(g\))</h3>
            <p class="math">
              \({}^{G}a_{\overline{n}|i,g}=\dfrac{1-\left(\frac{1+g}{1+i}\right)^n}{i-g}\) (for \(i\neq g\)); perpetuity \(\dfrac{1}{i-g}\) if \(i>g\).
            </p>
            <div class="inputs">
              <label>n: <input type="number" id="geo-n" value="12"></label>
              <label>i (%): <input type="number" id="geo-i" value="7" step="0.01"></label>
              <label>g (%): <input type="number" id="geo-g" value="3" step="0.01"></label>
              <button class="ghost magnet" id="btn-geo">Compute</button>
              <div class="result"><span>PV Geometric:</span> <code id="res-geo">—</code></div>
            </div>
            <p class="cite"><a class="link-animated" href="#sources" data-source="kent-formulas">[Kent Formulas]</a> <a class="link-animated" href="#sources" data-source="actex-fm">[ACTEX Sheet]</a></p>
          </article>
        </div>

        <footer class="scene-footer">
          <button class="next magnet" data-next="scene-4">CUT → Loans</button>
        </footer>
      </section>

      <!-- 4. LOANS -->
      <section id="scene-4" class="scene">
        <header class="scene-header">
          <h2 class="gradient-text">4) Loans, Amortization & Sinking Funds</h2>
          <p>Level payments and outstanding balance.</p>
          <div class="controls">
            <button class="primary magnet play" data-play="scene-4">▶ Play Scene</button>
          </div>
        </header>

        <div class="story">
          <div class="narration" id="nar-scene-4"></div>
        </div>

        <div class="grid two">
          <article class="card" data-reveal>
            <h3>Level-Payment Loan</h3>
            <p class="math">Payment \(P=\dfrac{L}{a_{\overline{n}|i}}\). Interest \(I_t=iB_{t-1}\), Principal \(=P-I_t\).</p>
            <div class="inputs">
              <label>Principal L: <input type="number" id="loan-L" value="20000"></label>
              <label>i (%): <input type="number" id="loan-i" value="6" step="0.01"></label>
              <label>n payments: <input type="number" id="loan-n" value="60"></label>
              <button class="ghost magnet" id="btn-loan">Build Schedule</button>
              <div class="result"><span>Payment P:</span> <code id="loan-P">—</code></div>
            </div>
            <div class="table-wrap" id="loan-table-wrap" aria-live="polite"></div>
            <p class="cite"><a class="link-animated" href="#sources" data-source="actex-fm">[ACTEX Sheet]</a></p>
          </article>

          <article class="card" data-reveal>
            <h3>Outstanding Balance</h3>
            <p class="math">
              Prospective: \(B_t=P\,a_{\overline{n-t}|i}\).<br/>
              Retrospective: \(B_t=L(1+i)^t - P\,s_{\overline{t}|i}\).
            </p>
            <div class="inputs">
              <label>t: <input type="number" id="loan-t" value="12" min="0"></label>
              <button class="ghost magnet" id="btn-balance">Compute \(B_t\)</button>
              <div class="result"><span>Prospective:</span> <code id="bal-pro">—</code></div>
              <div class="result"><span>Retrospective:</span> <code id="bal-ret">—</code></div>
            </div>
            <p class="cite"><a class="link-animated" href="#sources" data-source="actex-fm">[ACTEX Sheet]</a></p>
          </article>
        </div>

        <footer class="scene-footer">
          <button class="next magnet" data-next="scene-5">CUT → Bonds</button>
        </footer>
      </section>

      <!-- 5. BONDS -->
      <section id="scene-5" class="scene">
        <header class="scene-header">
          <h2 class="gradient-text">5) Bonds</h2>
          <p>Pricing, book value recursion, and between-coupon pricing.</p>
          <div class="controls">
            <button class="primary magnet play" data-play="scene-5">▶ Play Scene</button>
          </div>
        </header>

        <div class="story">
          <div class="narration" id="nar-scene-5"></div>
        </div>

        <div class="grid two">
          <article class="card" data-reveal>
            <h3>Price, Premium/Discount</h3>
            <p class="math">
              \(P=Fr\,a_{\overline{n}|i}+Cv^n\) and \(P=C+(Fr-Ci)\,a_{\overline{n}|i}\).
            </p>
            <div class="inputs">
              <label>Face F: <input type="number" id="bond-F" value="1000"></label>
              <label>Redemption C: <input type="number" id="bond-C" value="1000"></label>
              <label>Coupon rate r (%/period): <input type="number" id="bond-r" value="4" step="0.01"></label>
              <label>Yield i (%/period): <input type="number" id="bond-i" value="5" step="0.01"></label>
              <label>n periods: <input type="number" id="bond-n" value="10"></label>
              <button class="ghost magnet" id="btn-bond">Price Bond</button>
              <div class="result"><span>Price P:</span> <code id="bond-P">—</code></div>
            </div>
            <p class="cite"><a class="link-animated" href="#sources" data-source="actex-fm">[ACTEX Sheet]</a></p>
          </article>

          <article class="card" data-reveal>
            <h3>Book Value Recursion</h3>
            <p class="math">\(B_t=B_{t-1}(1+i)-Fr\), \(B_0=P\), \(B_n=C\).</p>
            <div class="inputs">
              <label>Show schedule? <input type="checkbox" id="bond-sched" checked></label>
            </div>
            <div class="table-wrap" id="bond-table-wrap" aria-live="polite"></div>
            <p class="cite"><a class="link-animated" href="#sources" data-source="actex-fm">[ACTEX Sheet]</a></p>
          </article>

          <article class="card full" data-reveal>
            <h3>Between-Coupon (Dirty/Clean)</h3>
            <p>Dirty = quoted price + accrued interest; Clean = Dirty − Accrued (convention summary).</p>
            <div class="inputs">
              <label>Days since last coupon: <input type="number" id="bc-days" value="45"></label>
              <label>Days in coupon period: <input type="number" id="bc-period" value="182"></label>
              <button class="ghost magnet" id="btn-bc">Compute</button>
              <div class="result"><span>Accrued:</span> <code id="bc-accrued">—</code></div>
              <div class="result"><span>Dirty:</span> <code id="bc-dirty">—</code></div>
              <div class="result"><span>Clean:</span> <code id="bc-clean">—</code></div>
            </div>
            <p class="cite"><a class="link-animated" href="#sources" data-source="soa-samples">[SOA Samples]</a></p>
          </article>
        </div>

        <footer class="scene-footer">
          <button class="next magnet" data-next="scene-6">CUT → Duration</button>
        </footer>
      </section>

      <!-- 6. DURATION & CONVEXITY -->
      <section id="scene-6" class="scene">
        <header class="scene-header">
          <h2 class="gradient-text">6) Duration & Convexity</h2>
          <p>Measure interest-rate sensitivity and curvature.</p>
          <div class="controls">
            <button class="primary magnet play" data-play="scene-6">▶ Play Scene</button>
          </div>
        </header>

        <div class="story">
          <div class="narration" id="nar-scene-6"></div>
        </div>

        <div class="grid two">
          <article class="card" data-reveal>
            <h3>Definitions</h3>
            <p class="math">
              Macaulay: \(D=\dfrac{\sum t\,v^t\,CF_t}{P}\). Modified: \(D_m=\dfrac{D}{1+i}\).<br/>
              Convexity: \(C=\dfrac{\sum t(t+1)\,v^{t+2}\,CF_t}{P}\), modified \(=C/(1+i)^2\).<br/>
              Approx: \(\Delta P/P\approx -D_m\Delta i+\tfrac12 C_m(\Delta i)^2\).
            </p>
            <p class="cite"><a class="link-animated" href="#sources" data-source="actex-fm">[ACTEX Sheet]</a></p>
          </article>

          <article class="card" data-reveal>
            <h3>Calculator</h3>
            <div class="inputs">
              <label>CFs (t=1..n): <input type="text" id="dur-cf" value="40,40,40,40,1040"></label>
              <label>i (%): <input type="number" id="dur-i" value="5" step="0.01"></label>
              <button class="ghost magnet" id="btn-dur">Compute</button>
              <div class="result"><span>Price P:</span> <code id="dur-P">—</code></div>
              <div class="result"><span>Mac D:</span> <code id="dur-mac">—</code></div>
              <div class="result"><span>Mod D:</span> <code id="dur-mod">—</code></div>
              <div class="result"><span>Mac C:</span> <code id="dur-cmac">—</code></div>
              <div class="result"><span>Mod C:</span> <code id="dur-cmod">—</code></div>
            </div>
          </article>
        </div>

        <footer class="scene-footer">
          <button class="next magnet" data-next="scene-7">CUT → Term Structure</button>
        </footer>
      </section>

      <!-- 7. TERM STRUCTURE -->
      <section id="scene-7" class="scene">
        <header class="scene-header">
          <h2 class="gradient-text">7) Term Structure, Discount Factors & Forwards</h2>
          <div class="controls">
            <button class="primary magnet play" data-play="scene-7">▶ Play Scene</button>
          </div>
        </header>

        <div class="story">
          <div class="narration" id="nar-scene-7"></div>
        </div>

        <div class="grid two">
          <article class="card" data-reveal>
            <h3>Discount & Forward</h3>
            <p class="math">
              \(P(0,t)=\dfrac{1}{(1+s_t)^t}\),&nbsp;
              \(1+f_{t,t+1}=\dfrac{(1+s_{t+1})^{t+1}}{(1+s_t)^t}\).<br/>
              Par \(r_{\text{par}}=\dfrac{1-P(0,n)}{\sum_{t=1}^{n}P(0,t)}\).
            </p>
            <p class="cite"><a class="link-animated" href="#sources" data-source="actex-fm">[ACTEX Sheet]</a> <a class="link-animated" href="#sources" data-source="soa-syllabus">[SOA Syllabus]</a></p>
          </article>

          <article class="card" data-reveal>
            <h3>Curve Lab</h3>
            <div class="inputs">
              <label>Spot rates s₁..s₅ (%): 
                <input type="text" id="spot-seq" value="3,3.2,3.5,3.7,4">
              </label>
              <button class="ghost magnet" id="btn-curve">Build curve</button>
              <div class="result"><span>P(0,t) list:</span> <code id="df-list">—</code></div>
              <div class="result"><span>Forwards f<sub>t,t+1</sub>:</span> <code id="fw-list">—</code></div>
              <div class="result"><span>Par yield:</span> <code id="par-yield">—</code></div>
              <canvas id="curve-canvas" width="800" height="220" aria-label="Yield curve chart"></canvas>
            </div>
          </article>
        </div>

        <footer class="scene-footer">
          <button class="next magnet" data-next="scene-8">CUT → Immunization</button>
        </footer>
      </section>

      <!-- 8. IMMUNIZATION -->
      <section id="scene-8" class="scene">
        <header class="scene-header">
          <h2 class="gradient-text">8) Immunization & Matching</h2>
          <p>Redington conditions in practice.</p>
          <div class="controls">
            <button class="primary magnet play" data-play="scene-8">▶ Play Scene</button>
          </div>
        </header>

        <div class="story">
          <div class="narration" id="nar-scene-8"></div>
        </div>

        <div class="grid two">
          <article class="card" data-reveal>
            <h3>Redington Conditions</h3>
            <p class="math">
              At \(i^\*\): match \(PV\) and Macaulay \(D\), and ensure \(C_A>C_L\) for local immunization.
            </p>
            <p class="cite"><a class="link-animated" href="#sources" data-source="actex-fm">[ACTEX Sheet]</a> <a class="link-animated" href="#sources" data-source="soa-samples">[SOA Samples]</a></p>
          </article>

          <article class="card" data-reveal>
            <h3>Immunization Lab</h3>
            <div class="inputs">
              <label>Liability CFs: <input type="text" id="imm-L" value="0,0,0,0,1000"></label>
              <label>Assets CFs: <input type="text" id="imm-A" value="100,100,100,100,900"></label>
              <label>i* (%): <input type="number" id="imm-i" value="5" step="0.01"></label>
              <button class="ghost magnet" id="btn-imm">Check</button>
              <div class="result"><span>PV(A), PV(L):</span> <code id="imm-pv">—</code></div>
              <div class="result"><span>Dur(A), Dur(L):</span> <code id="imm-dur">—</code></div>
              <div class="result"><span>Conv(A), Conv(L):</span> <code id="imm-conv">—</code></div>
              <div class="result"><span>Redington?</span> <code id="imm-res">—</code></div>
            </div>
          </article>
        </div>

        <footer class="scene-footer">
          <button class="next magnet" data-next="scene-9">CUT → Swaps</button>
        </footer>
      </section>

      <!-- 9. SWAPS -->
      <section id="scene-9" class="scene">
        <header class="scene-header">
          <h2 class="gradient-text">9) Interest Rate Swaps</h2>
          <p>Par fixed rate and value from discount factors.</p>
          <div class="controls">
            <button class="primary magnet play" data-play="scene-9">▶ Play Scene</button>
          </div>
        </header>

        <div class="story">
          <div class="narration" id="nar-scene-9"></div>
        </div>

        <div class="grid two">
          <article class="card" data-reveal>
            <h3>Plain-Vanilla Fixed-for-Floating</h3>
            <p class="math">
              \(S^\*=\dfrac{1-P(0,n)}{\sum_{t=1}^{n}\alpha_t P(0,t)}\),&nbsp;
              \(V=N\Big(S\sum \alpha_t P(0,t)-[1-P(0,n)]\Big)\).
            </p>
            <p class="cite"><a class="link-animated" href="#sources" data-source="actex-fm">[ACTEX Sheet]</a> <a class="link-animated" href="#sources" data-source="soa-samples">[SOA Samples]</a></p>
          </article>

          <article class="card" data-reveal>
            <h3>Swap Lab</h3>
            <div class="inputs">
              <label>Discount factors P(0,1..n): <input type="text" id="swap-df" value="0.97,0.94,0.90"></label>
              <label>α list: <input type="text" id="swap-alpha" value="1,1,1"></label>
              <label>Fixed S (%): <input type="number" id="swap-S" value="4" step="0.01"></label>
              <label>Notional N: <input type="number" id="swap-N" value="1000000" step="1000"></label>
              <button class="ghost magnet" id="btn-swap">Price Swap</button>
              <div class="result"><span>Par S*:</span> <code id="swap-Sstar">—</code></div>
              <div class="result"><span>V:</span> <code id="swap-V">—</code></div>
            </div>
          </article>
        </div>

        <footer class="scene-footer">
          <button class="next magnet" data-next="scene-10">CUT → Odds & Ends</button>
        </footer>
      </section>

      <!-- 10. ODDS & ENDS -->
      <section id="scene-10" class="scene">
        <header class="scene-header">
          <h2 class="gradient-text">10) Odds & Ends</h2>
          <p>Deferred perpetuities, DV01, and IRR vs TWR.</p>
          <div class="controls">
            <button class="primary magnet play" data-play="scene-10">▶ Play Scene</button>
          </div>
        </header>

        <div class="story">
          <div class="narration" id="nar-scene-10"></div>
        </div>

        <div class="grid two">
          <article class="card" data-reveal>
            <h3>Deferred Perpetuity</h3>
            <p class="math">First payment at \(t=m+1\): \(PV=v^{m}\cdot \dfrac{1}{i}\).</p>
            <div class="inputs">
              <label>i (%): <input type="number" id="od-i" value="6" step="0.01"></label>
              <label>m (deferral): <input type="number" id="od-m" value="3"></label>
              <button class="ghost magnet" id="btn-od-perp">Compute</button>
              <div class="result"><span>PV:</span> <code id="od-perp">—</code></div>
            </div>
            <p class="cite"><a class="link-animated" href="#sources" data-source="actex-fm">[ACTEX Sheet]</a></p>
          </article>

          <article class="card" data-reveal>
            <h3>Risk Shortcuts</h3>
            <p class="math">
              DV01 \(\approx 0.0001\cdot P\cdot D_{\text{Mod}}\). Dollar duration \(=-P\cdot D_{\text{Mod}}\).
            </p>
            <div class="inputs">
              <label>P: <input type="number" id="od-P" value="980"></label>
              <label>Mod D: <input type="number" id="od-D" value="4.2" step="0.01"></label>
              <button class="ghost magnet" id="btn-od-dv01">Compute</button>
              <div class="result"><span>DV01:</span> <code id="od-dv01">—</code></div>
              <div class="result"><span>Dollar Duration:</span> <code id="od-ddur">—</code></div>
            </div>
            <p class="cite"><a class="link-animated" href="#sources" data-source="actex-fm">[ACTEX Sheet]</a></p>
          </article>

          <article class="card full" data-reveal>
            <h3>IRR vs Time-Weighted Return</h3>
            <p>Money-weighted solves \(\sum C_t(1+j)^{-t}=0\). Time-weighted compounds subperiod returns.</p>
            <div class="inputs">
              <label>Subperiod returns (%): <input type="text" id="tw-returns" value="2,-1,3"></label>
              <label>Cashflows for IRR: <input type="text" id="irr-cf" value="-1000,200,300,600"></label>
              <button class="ghost magnet" id="btn-irr">Compute</button>
              <div class="result"><span>Time-weighted:</span> <code id="tw-res">—</code></div>
              <div class="result"><span>IRR (%):</span> <code id="irr-res">—</code></div>
            </div>
            <p class="cite"><a class="link-animated" href="#sources" data-source="soa-syllabus">[SOA Syllabus]</a></p>
          </article>
        </div>

        <footer class="scene-footer">
          <button class="primary magnet" data-next="scene-intro">CUT → Prologue</button>
        </footer>
      </section>
    </main>
  </div>

  <!-- Sources Drawer -->
  <div id="sources" class="sources-drawer" aria-hidden="true" role="dialog" aria-label="Sources and citations">
    <div class="drawer-content">
      <button class="close magnet" aria-label="Close">&times;</button>
      <h3>Sources & Citations</h3>

      <ul class="source-cards">
        <li id="src-soa-syllabus" class="source-card">
          <div class="badge">📘 Official</div>
          <div class="title">SOA — Exam FM Study Page & Syllabus</div>
          <p class="desc">Official learning objectives and scope for Exam FM.</p>
          <a class="chip link-animated" target="_blank" rel="noopener" href="https://www.soa.org/education/exam-req/edu-exam-fm-detail/study/">Open soa.org</a>
        </li>

        <li id="src-actex-fm" class="source-card">
          <div class="badge">📄 Formula Sheet</div>
          <div class="title">ACTEX — Exam FM Formula & Review Sheet (2023-06-29)</div>
          <p class="desc">Public formula sheet covering annuities, bonds, duration/convexity, swaps, etc.</p>
          <a class="chip link-animated" target="_blank" rel="noopener" href="https://www.actexlearning.com/formula-sheets/FM_FS.pdf">Open actexlearning.com</a>
        </li>

        <li id="src-kent" class="source-card">
          <div class="badge">🧮 Formulas</div>
          <div class="title">Kent State — Exam FM/2 Interest Theory Formulas</div>
          <p class="desc">Compact reference of core interest theory identities and annuity relations.</p>
          <a class="chip link-animated" target="_blank" rel="noopener" href="https://www.math.kent.edu/~darci/forstudents/mti/handouts/Theory_of_Interest_Formulas.pdf">Open math.kent.edu</a>
        </li>

        <li id="src-soa-samples" class="source-card">
          <div class="badge">📝 Samples</div>
          <div class="title">SOA — Exam FM Sample Questions & Solutions</div>
          <p class="desc">Official sample items demonstrating use of formulas in context.</p>
          <a class="chip link-animated" target="_blank" rel="noopener" href="https://www.soa.org/globalassets/assets/Files/Edu/2018/2018-10-exam-fm-sample-solutions.pdf">Open soa.org</a>
        </li>

        <li id="src-nexus" class="source-card">
          <div class="badge">🧭 Cheat Sheet</div>
          <div class="title">The Actuarial Nexus — Free FM Cheat Sheet (consolidated)</div>
          <p class="desc">Community resource that aggregates the same canon of FM formulas.</p>
          <a class="chip link-animated" target="_blank" rel="noopener" href="https://docs.theactuarialnexus.com/docs/examFM/cheat-sheet">Open theactuarialnexus.com</a>
        </li>
      </ul>

      <p class="small">
        Inline labels like <span class="inline-badge">[SOA Syllabus]</span> or <span class="inline-badge">[ACTEX Sheet]</span> map to the cards above.
      </p>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
<!-- partial -->
  <script  src="./script.js"></script>

</body>
</html>
